# JAVA SOAP-сервіс з підтримкою системи «Трембіта»

SOAP-сервіс, описаний в даній інструкції, розроблений мовою програмування Java з використанням фреймворку Spring, підтримує синхронний та асинхронний режим роботи і є сумісним з системою «Трембіта».

Spring - це сучасний, швидкий (високопродуктивний) фреймворк для Java.

Даний сервіс передбачає отримання з бази даних (реєстру) відомостей про інформаційні об'єкти (користувачів) та управління їх статусом, у тому числі обробку запитів на пошук, отримання, створення, редагування та видалення об'єктів.

Для демонстрації інтеграції з системою «Трембіта» було розроблено [вебклієнт](https://github.com/Trembita-installation/dev-services-and-clients/tree/main/client-SOAP/Java) для роботи з даним вебсервісом.

## Вимоги до програмного забезпечення
| ПЗ            |   Версія   | Примітка                                                                                                                                                                                               |
|:--------------|:----------:|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Ubuntu Server |   24.04    | Рекомендовані характеристики віртуальної машини:<br/> CPU: 1 <br/> RAM: 512 Мб                                                                                                                         |
| Java          | **17+**    | За допомогою скрипта встановлюється автоматично.<br/> Також можна встановити вручну при виборі відповідного типу інсталяції.<br/>**Важливо!** Якщо версія Java нижче 17, сервіс працювати не буде.     |
| PostgreSQL    |   14.12+   | За допомогою скрипта встановлюється автоматично.<br/> Також можна встановити вручну при виборі відповідного типу інсталяції                                                                            |
| Git           |            | Для клонування репозиторію                                                                                                                                                                             |

## Інсталяція сервісу

Сервіс можна інсталювати за допомогою скрипта автоматичного встановлення або вручну.
- [Інсталяція сервісу за допомогою скрипта автоматичного встановлення](./docs/script_installation.md).
- [Інсталяція сервісу вручну](./docs/manual_installation.md).
- [Конфігурація сервісу](./docs/configuration.md).

## Наповнення бази даних тестовими записами

Для забезпечення зручності тестування розробленого SOAP-вебсервісу потрібно наповнити його БД тестовими записами.

З цією метою було створено окремий скрипт на мові програмування Python, який використовує бібліотеку `Faker` для генерації тестових записів для бази даних (реєстру) користувачів.

Скрипт генерує тестові дані для записів про користувачів, такі як:

- ім'я,
- прізвище,
- по батькові,
- дата народження,
- РНОКПП,
- УНЗР,
- номер паспорта (формат для ID-карти, без серії),
- стать.

І надсилає ці дані на локальний сервер за адресою `http://localhost:8080/ws`.

Запит виконується з використанням бібліотеки `requests`, дані надсилаються у форматі XML. Успішні запити відображають відповідь сервера, а помилкові — статусний код і текст відповіді.

Для його запуску на віртуальній машині з розгорнутим та налаштованим вебсервісом необхідно виконати наступні дії:

1.  Встановити Python:

   ```bash
   sudo apt install python3 python3-pip -y
   ```

2. Встановити бібліотеку Faker:
   ```bash
      python3 -m pip install faker
   ```

3.  Запустити скрипт:
   ```python
   python3 fill_fakerdb_soap.py 100
   ```
де 100 - кількість об'єктів (користувачів), яка буде згенерована та додана до БД. Можна встановити необхідну кількість записів.

## Адміністрування сервісу

Для адміністрування вебсервісу було створено скрипт `springwsoap-service.sh`.
За допомогою даного скрипта можна:
- створити файл системної служби типу systemd для запуску вебсервісу та додає його до автозапуску;
- запусти вебсервіс;
- зупинити вебсервіс;
- видалити вебсервіс.

Для виконання необхідної дії необхідно:

1. Перейти в директорію з вебсервісом:

```bash
cd SpringWSsoap/
```

2.Зробити скріпт виконуваним:

   ```bash
   chmod +x springwsoap-service.sh
   ```

3. Запустити скрипт:

```bash
sudo bash springws-service.sh
```
4. Ввести цифру необхідної дії (1,2,3 і тд).

**Примітка:** Після встановлення вебсервісу необхідно, за допомого скрипта, створити створити файл системної служби типу systemd для запуску вебсервісу.

### Запуск вебсервісу

Для запуска вебсервісу необхідно виконати наступну команду:

   ```bash
   sudo bash springwsoap-service.sh start
   ```

### Ознайомлення з документацією АРІ

Після запуску вебсервісу можна отримати доступ до автоматичної **документації API** за наступними адресами:

- Doc: http://[адреса серверу]:8080/
- WSDL-файл: http://[адреса серверу]:8080/ws/persons.wsdl

### Перевірка статусу вебсервісу

Для перевірки статусу вебсервісу необхідно виконати наступну команду:

```bash
sudo systemctl status springwsoap
```

### Зупинка вебсервісу

Для зупинки вебсервісу необхідно виконати наступну команду:

   ```bash
   sudo bash springwsoap-service.sh stop
   ```

### Видалення вебсервісу.


### Перегляд журналу подій

За замовчуванням журнал подій зберігається у файлі `/tmp/springWSsoap.log`.

Конфігурація параметрів журналювання подій виконується в файлі «config.ini». Детальніше з параметрами журналювання в даному файлі можна ознайомитися в [настановах з конфігурації](./docs/configuration.md).

Для того, щоб переглянути журнал подій вебсервісу необхідно виконати команду:

```bash
journalctl -u springwsoap
```

### Налаштування HTTPS
Налаштування підключення до сервісу за протоколом HTTPS наведено [в інструкції](./docs/https_nginx_reverse_proxy.md).

## Інтеграція вебсервісу з системою «Трембіта»

Системи «Трембіта» не вимагає особливої спеціалізації вебсервісів для роботи з нею.

Для повноцінної інтеграції вебсервісів з системою «Трембіта» вебсервіс повинен підтримувати можливість зберігання заголовків системи «Трембіта», які було передані в запиті від вебкліента через ШБО.

Більш детальну інформацію про заголовки наведено в описі [заголовків запитів для SOAP-сервісів](https://github.com/nataLee-git/Services-development-for-Trembita-system/blob/main/SOAP%20services%20development%20for%20Trembita%20system.md#%D0%B7%D0%B0%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BA%D0%B8-%D0%B7%D0%B0%D0%BF%D0%B8%D1%82%D1%96%D0%B2-%D0%B4%D0%BB%D1%8F-soap-%D1%81%D0%B5%D1%80%D0%B2%D1%96%D1%81%D1%96%D0%B2-%D0%BD%D0%B5%D0%BE%D0%B1%D1%85%D1%96%D0%B4%D0%BD%D1%96-%D0%B7%D0%B0%D0%B4%D0%BB%D1%8F-%D0%B7%D0%B0%D0%B1%D0%B5%D0%B7%D0%BF%D0%B5%D1%87%D0%B5%D0%BD%D0%BD%D1%8F-%D1%81%D1%83%D0%BC%D1%96%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%96-%D0%B7-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%BE%D1%8E-%D1%82%D1%80%D0%B5%D0%BC%D0%B1%D1%96%D1%82%D0%B0), які необхідні задля забезпечення сумісності з системою "Трембіта".

## Використання сервісу

Вебсервіс підтримує синхронний та асинхронний режим роботи.

Синхронний режим роботи вебсервісу представляє собою набір з 5 методів, які дозволяють управляти записами про умовних користувачів (Person) в БД:

- [створення нового запису](./docs/using.md#Add-Persona);
- [отримання всіх записів з БД](./docs/using.md#Get-Person-List);
- [отримання запису по заданому критерію пошуку](./docs/using.md#Get-Persona-By-Parametr);
- [оновлення існуючого запису за кодом РНОКПП](./docs/using.md#Update-Personа);
- [видалення існуючого запису за кодом РНОКПП](./docs/using.md#Delete-Personа).

Асинхронний режим роботи предствалений одними методом, який виконує [перевірку обраного користувача на протязі 5 хвилин](./docs/using.md#Check-Personа).

Після встановлення вебсервісу його база даних порожня.
Для демонстрації можливостей вебсервісу першим кроком необхідно створити нові записи в БД. Це можна зробити відповідним [вебклієнтом](https://github.com/Trembita-installation/dev-services-and-clients/tree/main/client-SOAP/Java) з використанням методу [Person Post](./docs/using.md#Add-Persona), або за допомогою [скрипта наповнення бази даних](./README.md#наповнення-бази-даних-тестовими-записами)


## Ліцензія

Цей проєкт ліцензується відповідно до умов MIT License.

##
Матеріали створено за підтримки проєкту міжнародної технічної допомоги «Підтримка ЄС цифрової трансформації України (DT4UA)».
