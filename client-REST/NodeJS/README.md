# Синхронний Node.JS REST-клієнт з підтримкою системи «Трембіта»

## Опис клієнту

REST-клієнт, описаний в даній інструкції, розроблений мовою програмування JavaScript з використанням Node.js та React і є сумісним з системою «Трембіта».

React — це декларативна, ефективна і гнучка JavaScript-бібліотека, призначена для створення інтерфейсів користувача.

Даний клієнт передбачає отримання відомостей про інформаційні об’єкти (користувачів) та управління їх статусом, у тому числі відправку запитів на пошук, отримання, створення, редагування та видалення об’єктів до відповідного сервісу.

Додатково передбачено функції завантаження архівів з підписаними електронними повідомленнями-запитами, повідомленнями-відповідями у вигляді ASiC-контейнерів, а також генерацію ключів і сертифікатів для взаємної автентифікації між REST-клієнтом та ШБО системи «Трембіта».

Для демонстрації інтеграції з системою «Трембіта» було розроблено [вебсервіс](https://github.com/Trembita-installation/dev-services-and-clients/Trembita_JS_R_SyncSrv) для роботи з даним вебклієнтом.

## Вимоги до програмного забезпечення

| ПЗ            |   Версія   | Примітка                                                                                                                                                                                               |
|:--------------|:----------:|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Ubuntu Server |   24.04    | Рекомендовані характеристики віртуальної машини:<br/> CPU: 1 <br/> RAM: 512 Мб                                                                                                                         |
| Node js         | **20.15.1++**  | За допомогою скрипта встановлюється автоматично.<br/> Також можна встановити вручну при виборі відповідного типу інсталяції.<br/>**Важливо!** Якщо версія Node js нижче 20.15.1, клієнт працювати не буде. |
| npm       |  v10.7.0+    | За допомогою скрипта встановлюється автоматично.<br/> Також можна встановити вручну при виборі відповідного типу інсталяції                                                                            |
| Git           |            | Для клонування репозиторію |


## Структура проєкту

Проєкт складається з наступних файлів та директорій:

```
rest-sync-client-next-js-page-router/
|-- asic                                    # Директорія для asic контейнерів
|-- certs                                   # Директорія для сертифікатів
|   |-- cert.pem                            # Файл сертифіката
|   |-- key.pem                             # Файл ключа
|   |-- service-cert.pem                    # Файл сертифіката сервісу
|-- components                              # Директорія з компонентами React
|   |-- DropdownComponent.js                # Компонент випадаючого списку
|   |-- FormComponent.js                    # Компонент форми
|   |-- NavBar.js                           # Компонент навігаційної панелі
|   |-- PaginationComponent.js              # Компонент пагінації
|-- logs                                    # Директорія для зберігання логів
|   |-- combined.log                        # Логи для об'єднаних повідомлень
|   |-- error.log                           # Логи для повідомлень про помилки
|-- node_modules**                          # Директорія з залежностями Node.js
|-- pages                                   # Директорія з сторінками Next.js
|   |-- api                                 # API маршрути
|   |   |-- download.js                     # API маршрут для завантаження
|   |   |-- list-asic.js                    # API маршрут для списку ASIC
|   |   |-- person.js                       # API маршрут для роботи з особами
|   |-- _app.js                             # Глобальний компонент застосунку
|   |-- add-person.js                       # Сторінка для додавання особи
|   |-- download-asic.js                    # Сторінка для завантаження ASIC
|   |-- find-person.js                      # Сторінка для пошуку особи
|   |-- index.js                            # Головна сторінка
|   |-- read-person.js                      # Сторінка для читання інформації про особу
|-- public                                  # Директорія для публічних файлів
|   |-- favicon.ico                         # Фавіконка сайту
|-- styles                                  # Директорія зі стилями
|   |-- globals.css                         # Глобальні стилі
|-- utils                                   # Директорія з утилітами
|   |-- axiosBackend.js                     # Налаштування axios для бекенду
|   |-- axiosFrontend.js                    # Налаштування axios для фронтенду
|   |-- getUxpHeaders.js                    # Функція для отримання заголовків UXP
|   |-- getUxpParams.js                     # Функція для отримання параметрів UXP
|   |-- logger.js                           # Логування
|   |-- middleware.js                       # Проміжні обробники
|   |-- saveAsic.js                         # Збереження ASIC
|-- .env.local                              # Конфігурація середовища
|-- .gitignore                              # Ігнорування файлів Git
|-- certificates.js                         # Скрипт для генерації сертифікатів
|-- LICENSE                                 # Ліцензійний файл
|-- next.config.mjs                         # Конфігурація Next.js
|-- package.json                            # Залежності проєкту
|-- package-lock.json                       # Файл блокування залежностей
|-- README.md                               # Документація проєкту
```

## Інсталяція клієнту

Клієнт можна інсталювати за допомогою скрипта автоматичного встановлення або вручну. Також клієнт може працювати в Docker.

- [Інсталяція клієнту за допомогою скрипта автоматичного встановлення](./docs/script_installation.md).
- [Інсталяція клієнту вручну](./docs/manual_installation.md).
- [Конфігурація клієнту](./docs/configuration.md).
- [Pозгортання вебклієнту в Docker ](./docs/docker_installation.md).

## Адміністрування клієнту

### Запуск вебклієнту

Для запуска вебклієнту необхідно виконати наступну команду:

```bash
sudo systemctl start node-app-rest
```

### Доступ до вебклієнту

Для доступу до вебінтерфейсу вебклієнту необхідно перейти за посиланням: http://<your_server_ip>:3001


### Перевірка статусу вебклієнту

Для того, щоб перевірити статус вебклієнту необхідно виконати наступну команду:

```bash
sudo systemctl status node-app-rest
```

### Зупинка вебклієнту

Для зупинки роботи вебсервісу необхідно виконати наступну команду:
```bash
sudo systemctl stop node-app-rest
```

### Видалення вебклієнту

Для видалення вебклієнту та всіх пов'язаних компонентів було створено скрипт `remove.sh`.

Даний скрипт після запуску, зупинить та видалить вебклієнт, видалить віртуальне середовище, клонований репозиторій та системні залежності.

Для того, щоб запустити скрипт необхідно:

1. Зробити файл виконуваним:

```bash
chmod +x remove.sh
```

2. Запустити скрипт:

```bash
./remove.sh
```

### Перегляд журналу подій

За замовчуванням журнал подій зберігаються у двох файлах `error.log`та `combined.log`.

Конфігурація параметрів журналювання подій виконується в файлі «.env.local». Детальніше з параметрами журналювання в даних файлах можна ознайомитися в [настановах з конфігурації](/docs/configuration.md).

Для того, щоб переглянути журнал подій вебклієнту необхідно виконати команду:

```bash
journalctl -u node-app-rest -f
```

### Налаштування HTTPS

Для налаштування з’єднання з ШБО системи «Трембіта» за допомогою протоколу HTTPS необхідно виконати наступні кроки:

1. Вказати відповідний протокол в файлі конфігурації (файл `.env.local`, детальніше див.[настанови з конфігурування](./docs/configuration.md)).

2. Завантажити сертифікат вебклієнта (кнопка «Завантажити cert.pem» на головній сторінці вебінтерфейсу клієнту) до відповідної підсистеми ШБО.

3. Завантажити внутрішній TLS сертифікат ШБО до директорії сертифікатів вебклієнту ( за замовчуванням /rest-sync-client-next-js-page-router/certs/service-cert.pem, детальніше див.[настанови з конфігурування](./docs/configuration.md)).

**Важливо:** Веблкієнт підтримує лише сертифікати формату PEM

## Інтеграція вебклієнту з системою «Трембіта»

Для повноцінної інтеграції з системою «Трембіта» вебклієнт повинен мати можливість додавати до запиту HTTP заголовки, необхідні для передачі запитів між шлюзами безпечного обміну системи «Трембіта». Окрім цього для ідентифікації повідомлень в власній інформаційній системі вебклієнт для кожного запиту повинен задавати унікальний ідентифікатор з заголовком Uxp-queryID. Більш детальну інформацію про заголовки наведено в [описі роботи із REST-сервісами в системі «Трембіта»](https://github.com/Trembita-installation/dev-services-and-clients/Services-development-for-Trembita-system/blob/main/REST%20services%20development%20for%20Trembita%20system.md#%D0%B7%D0%B0%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BA%D0%B8-%D0%B7%D0%B0%D0%BF%D0%B8%D1%82%D1%96%D0%B2-%D0%B4%D0%BB%D1%8F-rest-%D1%81%D0%B5%D1%80%D0%B2%D1%96%D1%81%D1%96%D0%B2-%D0%BD%D0%B5%D0%BE%D0%B1%D1%85%D1%96%D0%B4%D0%BD%D1%96-%D0%B7%D0%B0%D0%B4%D0%BB%D1%8F-%D0%B7%D0%B0%D0%B1%D0%B5%D0%B7%D0%BF%D0%B5%D1%87%D0%B5%D0%BD%D0%BD%D1%8F-%D1%81%D1%83%D0%BC%D1%96%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%96-%D0%B7-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%BE%D1%8E-%D1%82%D1%80%D0%B5%D0%BC%D0%B1%D1%96%D1%82%D0%B0).

В даному вебклієнті конфігурування заголовків здійснюється в файлі конфігурації `.env.local`. Детальніше конфігурування заголовків описано в [настановах з конфігурування](./docs/configuration.md)

## Використання вебклієнту

Для доступу до вебінтерфейсу розробленого вебклієнту необхідно перейти за посиланням:

```
http://<your_server_ip>:5000
```

В даному інтерфейсі можна виконати наступні дії:
1.	Здійснювати пошук записів в БД за певними параметрами.
2.	Створювати записи в БД.
3.	Модифікувати записи в БД
4.	Видаляти записи в БД за УНЗР.
5.	В разі, якщо для зв’язку з ШБО системи «Трембіта» використовується HTTPS, буде доступна можливість завантажувати ASIC-контейнери з запитами від вебклієнта до вебсервісу, які були передані через даний ШБО

## Внесок

Якщо ви хочете зробити свій внесок у проєкт, будь ласка, створіть форк репозиторію і відправте Pull Request.

## Ліцензія

Цей проєкт ліцензований під ліцензією GPL v3. Дивіться файл [LICENSE](LICENSE) для деталей.
